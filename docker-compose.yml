name: inbox-zero-services\nservices:\n  db:\n    image: postgres\n    restart: always\n    container_name: inbox-zero-db\n    environment:\n      - POSTGRES_USER=${POSTGRES_USER:-postgres}\n      - POSTGRES_DB=${POSTGRES_DB:-inboxzero}\n      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-password}\n    volumes:\n      - database-data:/var/lib/postgresql/data/\n    networks:\n      - shared_net\n\n  redis:\n    image: redis\n    volumes:\n      - database-data:/data\n    networks:\n      - shared_net\n\n  serverless-redis-http:\n    image: hiett/serverless-redis-http:latest\n    env_file:\n      - ./apps/web/.env\n    environment:\n      SRH_MODE: env\n      SRH_TOKEN: ${UPSTASH_REDIS_TOKEN}\n      SRH_CONNECTION_STRING: "redis://redis:6379"\n    networks:\n      - shared_net\n\n  web:\n    image: ghcr.io/elie222/inbox-zero:latest\n    pull_policy: if_not_present\n    build:\n      context: .\n      dockerfile: ./docker/Dockerfile.prod\n    env_file:\n      - ./apps/web/.env\n    depends_on:\n      - db\n      - redis\n    networks:\n      - shared_net\n    environment:\n      DATABASE_URL: "postgresql://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-password}@db:5432/${POSTGRES_DB:-inboxzero}?schema=public"\n      DIRECT_URL: "postgresql://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-password}@db:5432/${POSTGRES_DB:-inboxzero}?schema=public"\n      UPSTASH_REDIS_URL: "http://serverless-redis-http:80"\n      UPSTASH_REDIS_TOKEN: "${UPSTASH_REDIS_TOKEN}"\n\nvolumes:\n  database-data:\n\nnetworks:\n  shared_net:\n    external: true\n